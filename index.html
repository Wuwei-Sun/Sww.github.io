<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>急性髓性白血病风险化学物筛查器</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .input-group { margin-bottom: 15px; }
        input { width: 100%; padding: 8px; margin-bottom: 8px; }
        button { padding: 10px 15px; background: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .external-link { margin-top: 30px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 5px; }
        .pubchem-link { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .info { color: #6c757d; font-size: 0.9em; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>急性髓性白血病风险化学物筛查器</h1>
        
        <div class="input-form">
            <h2>化学物信息输入</h2>
            <div id="input-fields">
                <div class="input-group">
                    <label for="SMILES">化学物SMILES号：</label>
                    <input type="text" id="SMILES" required placeholder="例如：c1ccccc1（苯的SMILES）">
                    
                    <!-- 添加PubChem查询链接区域 -->
                    <div class="pubchem-link">
                        <p class="info">
                            不知道化学物的SMILES号？可通过 
                            <a href="https://pubchem.ncbi.nlm.nih.gov/" target="_blank" rel="noopener noreferrer">
                                PubChem官网
                            </a> 
                            查询（在搜索框输入化学物名称，结果页中找到"SMILES"字段）
                        </p>
                    </div>
                    
                    <p class="info" id="smiles-validation"></p> <!-- 用于显示结果 -->
                </div>
            </div>
            <button type="button" onclick="predict()">预测风险</button>
            <div id="result"></div>

            <!-- SwissDock链接区域 -->
            <div class="external-link">
                <h3>相关工具推荐</h3>
                <p>如需进行蛋白质-小分子对接分析，可访问：</p>
                <a href="https://www.swissdock.ch/" target="_blank" rel="noopener noreferrer">
                    SwissDock（蛋白质对接平台）
                </a>
                <p>该平台提供免费的蛋白质-小分子对接计算服务，使用前请遵守其官方使用条款。</p>
            </div>
        </div>

        <script>
            function predict() {
                const smiles = document.getElementById("SMILES").value.trim();
                const resultDiv = document.getElementById("result");
                const validationDiv = document.getElementById("smiles-validation");

                // 预测前校验SMILES
                if (!smiles) {
                    resultDiv.innerHTML = '<p class="error">请输入有效的SMILES号！</p>';
                    return;
                }

                // 基础格式校验
                const smilesPattern = /^[A-Za-z0-9+=#@()\[\]{}._-]+$/;
                if (!smilesPattern.test(smiles)) {
                    if (!confirm("SMILES格式可能无效，是否继续预测？")) {
                        return;
                    }
                    validationDiv.innerHTML = '<span class="warning">警告：SMILES包含非标准字符，可能影响结果</span>';
                } else {
                    validationDiv.innerHTML = '<span class="success">SMILES格式校验通过</span>';
                }

                try {
                    resultDiv.innerHTML = '<p>正在进行风险预测...</p>';

                    fetch('/predict', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(smiles)
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(err => { throw new Error(err.error || "预测请求失败"); });
                        }
                        return response.json();
                    })
                    .then(data => {
                        resultDiv.innerHTML = `
                            <h3>预测结果</h3>
                            <p>化学物SMILES：${data.smiles || smiles}</p>
                            <p>急性髓性白血病风险评估：<strong>${data.prediction}</strong></p>
                        `;
                    })
                    .catch(error => {
                        resultDiv.innerHTML = `<p class="error">预测错误：${error.message}</p>`;
                    });
                } catch (error) {
                    resultDiv.innerHTML = `<p class="error">系统错误：${error.message}</p>`;
                }
            }
        </script>
    </div>
</body>
</html>